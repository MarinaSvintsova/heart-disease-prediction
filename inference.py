# -*- coding: utf-8 -*-
"""inference.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1PrKaZ5N_psSlf6VTK_Fn-hLLwM2iw3oE
"""

import numpy as np
import pandas as pd
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import RandomForestClassifier
import pickle

# Загрузка StandardScaler с использованием pickle
with open('models/scaler.pkl', 'rb') as f:
    scaler = pickle.load(f)

# Загрузка модели RandomForestClassifier с использованием pickle
with open('models/random_forest_model.pkl', 'rb') as f:
    rf_model = pickle.load(f)

# Загрузка новых данных
new_data = pd.read_csv('data/new_data.csv')

# Преобразование определенных столбцов в категориальный тип данных
new_data['sex'] = pd.Categorical(new_data['sex'])
new_data['exercise_induced_angina'] = pd.Categorical(new_data['exercise_induced_angina'])
new_data['fasting_blood_sugar'] = pd.Categorical(new_data['fasting_blood_sugar'], categories=[0, 1], ordered=True)
new_data['resting_electrocardiographic_results'] = pd.Categorical(new_data['resting_electrocardiographic_results'], categories=[0, 1, 2], ordered=True)
new_data['slope'] = pd.Categorical(new_data['slope'], ordered=True)
new_data['number_of_major_vessels'] = pd.Categorical(new_data['number_of_major_vessels'], ordered=True)
new_data['thal'] = pd.Categorical(new_data['thal'], categories=[3, 7, 6], ordered=True)

# Удаление незначительного столбца
new_data.drop('ID', axis=1, inplace=True)

# Проверка преобразованных данных
print(new_data.head())

# Предполагается, что у нас 13 признаков после преобразования
X_new = new_data.iloc[:, :13].values

# Применение стандартизации к новым данным
X_new_scaled = scaler.transform(X_new)

# Запуск инференса
rf_predictions = rf_model.predict(X_new_scaled)

# Вывод результатов предсказаний
print('Random Forest Predictions:', rf_predictions)